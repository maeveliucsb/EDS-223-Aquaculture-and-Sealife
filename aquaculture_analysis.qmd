---
title: "aquaculture_analysis"
author: 'Maeve'
date: 11/26/25
format: html
editor: visual
embed-resources: true
page-loading: false
code-fold: show
execute: 
  warning: false
  message: false
toc: TRUE
theme: journal
---
```{r, echo=FALSE, out.width="70%", fig-cap="Screenshot of README"}
knitr::include_graphics("readmesc.png")
```
# Introduction

This document analyzes aquaculture distribution as a sustainable alternative to land based meat production. For this assignment, I will determine which Exclusive Economic Zones (EEZ) on the West Coast of the US are best suited to developing marine aquaculture for several species of oysters and Geoducks, a saltwater clam with a nearly $80 million industry. Suitable locations will be determined based on range of suitable sea surface temperature (SST) and depth values for the species.


# Load libraries
These are the libraries necessary to complete the rest of the code in the document. 
```{r}
library(tidyverse)
library(sf)
library(terra)
library(tmap)
library(patchwork)
library(here)
library(dplyr)
library(viridis)
```


# Load data

SST files used:

-   `average_annual_sst_2008.tif`

-   `average_annual_sst_2009.tif`

-   `average_annual_sst_2010.tif`

-   `average_annual_sst_2011.tif`

-   `average_annual_sst_2012.tif`

Bathymetry files used:

-   depth.tif

## Exclusive Economic Zones

Exclusive Economic Zones files used:

-   wc_regions_clean.shp

```{r}
# Read in shapefile of EEZs
eez <- st_read(here("data", "wc_regions_clean.shp"))
```

## Sea surface temperature

```{r}
# Read in rasters of sea surface temerpature
sst_2008 <- rast(here("data", "average_annual_sst_2008.tif"))
sst_2009 <- rast(here("data", "average_annual_sst_2009.tif"))
sst_2010 <- rast(here("data", "average_annual_sst_2010.tif"))
sst_2011 <- rast(here("data", "average_annual_sst_2011.tif"))
sst_2012 <- rast(here("data", "average_annual_sst_2012.tif"))
```

## Bathymetry
This raster shows the varying depths of the pacific ocean

```{r}
# read in raster for depth
bath <- rast(here("data", "depth.tif"))
```

## Oysters

## Stack rasters
In this portion, I combine all 4 rasters into 1 raster called sst_stack.
```{r}
# Use c() to stack
sst_stack <- c(sst_2008, 
              sst_2009, 
              sst_2010,
              sst_2011, 
              sst_2012)
```

## Calculate mean
Now I calculate the mean of each of the cell values within the stack and convert it into celcius (to capture the temperature range of the oysters)
```{r}
# Get the mean of each of the cell values
sst_mean <- terra::app(sst_stack, mean, na.rm = TRUE)

# Globally subtract 273.15
sst_c_mean <- sst_mean - 273.15
stopifnot(inherits(sst_c_mean, "SpatRaster"))   # subtract 273.15 from every cell
```

## Reproject bathymetry
I then have to reproject my bathymetry raster and make sure that it's on the same CRS as my meaned stack of depths. 
```{r}
bath_reproj <- terra::project(bath, sst_c_mean)
```

Then I resample the bathymetry raster to the sea surface temperature.

```{r}
# Resample to SST
bath_aligned <- terra::resample(bath_reproj, sst_c_mean, method = "near")

# Check the extent
ext(bath_aligned) == ext(sst_c_mean)

# Check the resolution
res(bath_aligned) == res(sst_2008)
```

Create a matrix of oyster sea surface temperature threshold, and oyster depth range. This gives me the tools to later use to caputre the temperature and depth ranges of the oysters.
```{r}
# Matrix of SST rang
sst_osyter_matrix <- matrix(c(
  -Inf, 11, 0,
  11, 30, 1,
  30, Inf, 0),
ncol = 3,
byrow = TRUE)
  
# Matrix of depth range
depth_oyster_matrix <- matrix(c(
  -Inf, -70, 0,
  -70, 0, 1,
  0, Inf, 0),
  ncol = 3,
  byrow = TRUE
)
```

Reclassify the raster with the matrix. This reclassifies depth and temperature data to reflect the constraints I outlined in the matrix. 

```{r}
# Reclassify
sst_reclassify <- classify(sst_c_mean, sst_osyter_matrix)
bath_reclassify <- classify(bath_aligned, depth_oyster_matrix)
```

Multiply the rasters by each other.

```{r}
# Multiply the reclassified rasters by eachother
multiplied <- sst_reclassify * bath_reclassify

#reclassufying 0s as NAs
multiplied[multiplied == 0 ] <- NA

```

# making the most suitable area (for oysters)
This portion then amends the EEZ data to reflect the necessary conditions to make the oysters happy, it crops by the ranges specified in the multiplied raster, and re-rasterizes to make sure the conditions can still be mapped. 

```{r}
#cropping suitable cells to EEZ
multiplied_cropped <- crop(multiplied, eez)

#rasterizing
EEZrast <- rasterize(eez, multiplied_cropped, field = "area_km2")

```
# zonal statistics
This portion then amends the raster and maps it so that we can see visually where oysters would be the most happy and best for aquaculture. 
```{r}
multiplied_cropped <- cellSize(multiplied_cropped, mask = TRUE, lyrs = FALSE, unit = 'km')

zones_good_oysters <- terra::zonal(multiplied_cropped, 
                                   EEZrast, 
                                   fun = "sum", 
                                   na.rm = TRUE)
#changing names from the initial little mess to 
zones_annotated <- cbind(eez,zones_good_oysters)

zones_oysters_clean <- zones_annotated %>%
  dplyr::select(rgn, area_km2, area)%>%
  rename("good-oyster-spots" = "area")


map1 <- tm_shape(zones_oysters_clean)+
  tm_basemap("Esri.WorldGrayCanvas") + # dull background that still has geo info
  tm_graticules()+
  tm_polygons(fill = "good-oyster-spots",
              fill.scale = tm_scale(values = viridis (2)),
              fill.legend = tm_legend(title = "Area of suitable oyster habitat (km2)",
                                      posititon = tm_pos_out('right'))) + 
  tm_borders(col = 'black') + 
  tm_title(text = 'suitable habitat for this species in each eez')

map1
```

# generalizable workflow

This portion of the document applies the same workflow from the oyster to the geoduck (Panopea abrupta). Geoducks are a highly fluxuating market which is incredibly vulnerable to shocks, with prices ranging from $5-$10 per pound.

Geoducks preferred conditions: 
Preferred temperature (Ref. 115969): 5.7 - 20.6, mean 12.1 (based on 518 cells).
depth: Benthic; depth range 0 - 110 m

This portion outlines the necessary information for the following code chunks

```{r}
#creating variables to outline geoducks preferred conditions

#temperature
min_sst <- 5.7
max_sst <- 20.6
#depth
min_depth_m <- 0
max_depth_m <- 110
#species name (greek)
species_name <- "Panopea abrupta"
```

This portion uses the information from the oyster analysis and turns it into a function, which can be amended for a variety of animals, including but not limited to-geoducks. 
```{r}
clamwork <- function(eez, #initial eez file before you did stuff (transformed)
                             bath, #initial bath file before you transformed it 
                             sst_mean, #meaned sst file
                             min_sst, #assuming that its already cleaned
                             max_sst,
                             min_depth_m, 
                             max_depth_m, 
                             species_name){
# Globally subtract 273.15
  sst_c_mean <- sst_mean - 273.15 
    #reprojecting the bath crs
  bath_reproj <- terra::project(bath, sst_c_mean)
  # Resample to SST
  bath_aligned <- terra::resample(bath_reproj, sst_c_mean, method = "bilinear")

# Check the extent
  ext(bath_aligned) = ext(sst_c_mean) 

# Check the resolution
res(bath_aligned) = res(sst_2008) 
  
# Matrix of SST rang
sst_matrix <- matrix(c(
  -Inf, min_sst, 0,
  min_sst, max_sst, 1,
  max_sst, Inf, 0),
ncol = 3,
byrow = TRUE) 
  
# Matrix of depth range
depth_matrix <- matrix(c(
  -Inf, min_depth_m, 0,
  min_depth_m, max_depth_m, 1,
  max_depth_m, Inf, 0),
  ncol = 3,
  byrow = TRUE
)  
  # Reclassify
sst_reclassify <- classify(sst_c_mean, sst_matrix)
bath_reclassify <- classify(bath_aligned, depth_matrix) 
  # Multiply the reclassified rasters by eachother
multiplied <- sst_reclassify * bath_reclassify
  #cropping suitable cells to EEZ
multiplied_cropped <- crop(multiplied, eez) 

#rasterizing
EEZrast <- rasterize(eez, multiplied_cropped, field = "area_km2")
multiplied_cropped <- cellSize(multiplied_cropped, mask = TRUE, lyrs = FALSE, unit = 'km')

#might be unnecessary
suitable <- mask(multiplied_cropped, EEZrast) 
  
zones_good <- terra::zonal(multiplied_cropped, 
                                   EEZrast, 
                                   fun = "sum", 
                                   na.rm = TRUE)

#changing names from the inital little mess to 
zones_annotated <- cbind(eez,zones_good)

zones_clean <- zones_annotated %>%
  dplyr::select(rgn, area_km2, area_km2.1)%>%
  rename("good spots" = "area_km2.1") 

map <- tm_shape(zones_clean)+
  tm_basemap("Esri.WorldGrayCanvas") + # dull background that still has geo info
  tm_graticules()+
  tm_polygons(fill = "good spots",
              fill.scale = tm_scale(values = viridis (2)),
              fill.legend = tm_legend(title = "Area of suitable creature habitat (km2)",
                                      posititon = tm_pos_out('right'))) + 
  tm_borders(col = 'black') + 
  tm_title(text = 'suitable habitat for this species in each eez')
assign(paste0(species_name, "map"), map, envir = .GlobalEnv)
map  
}

clamwork(bath = bath, 
         eez = eez,
         sst_mean = sst_mean,
         min_sst = min_sst, 
         max_sst = max_sst, 
         min_depth_m = min_depth_m,
         max_depth_m = max_depth_m, 
         species_name = species_name)
```
# Written Reflection
This project outlines the conditions under which effective aquaculture is necessary and sufficient to provide protein to minimize land impact of livestock animals. Aquaculture is a proposed sustainable alternative to high land use behaviors such as cattle herding or agriculture, both of which can have strong negative impacts on land. This analysis illustrates (through the analysis of two different mollusks, geoducks and oysters) the amount of suitable land for aquaculture off the west coast of the United States and finds that there is a significant amount of land which can effectively be used for aquaculture, filling a need in two very high demand industries. 